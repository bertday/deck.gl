"use strict";(self.webpackChunkproject_website=self.webpackChunkproject_website||[]).push([[7117],{37072:(e,t,o)=>{o.d(t,{J:()=>i});var n=o(10513),r=o(38846);const i={props:{},name:"gouraudMaterial",vs:r.l.replace("phongMaterial","gouraudMaterial"),fs:r.X.replace("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:1},dependencies:[n.x],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(e){const t={...e};return t.specularColor&&(t.specularColor=t.specularColor.map((e=>e/255))),{...i.defaultUniforms,...t}}}},72404:(e,t,o)=>{o.d(t,{w:()=>i});var n=o(10513);var r=o(38846);const i={name:"phongMaterial",dependencies:[n.x],source:"struct phongMaterialUniforms {\n  ambient: f32,\n  diffuse: f32,\n  shininess: f32,\n  specularColor: vec3<f32>,\n};\n\n@binding(2) @group(0) var<uniform> material : phongMaterialUniforms;\n\nfn lighting_getLightColor(surfaceColor: vec3<f32>, light_direction: vec3<f32>, view_direction: vec3<f32>, normal_worldspace: vec3<f32>, color: vec3<f32>) -> vec3<f32> {\n  let halfway_direction: vec3<f32> = normalize(light_direction + view_direction);\n  var lambertian: f32 = dot(light_direction, normal_worldspace);\n  var specular: f32 = 0.0;\n  if (lambertian > 0.0) {\n    let specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);\n    specular = pow(specular_angle, material.shininess);\n  }\n  lambertian = max(lambertian, 0.0);\n  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;\n}\n\nfn lighting_getLightColor2(surfaceColor: vec3<f32>, cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32> {\n  var lightColor: vec3<f32> = surfaceColor;\n\n  if (lighting.enabled == 0) {\n    return lightColor;\n  }\n\n  let view_direction: vec3<f32> = normalize(cameraPosition - position_worldspace);\n  lightColor = material.ambient * surfaceColor * lighting.ambientColor;\n\n  if (lighting.lightType == 0) {\n    let pointLight: PointLight  = lighting_getPointLight(0);\n    let light_position_worldspace: vec3<f32> = pointLight.position;\n    let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);\n    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n  } else if (lighting.lightType == 1) {\n    var directionalLight: DirectionalLight = lighting_getDirectionalLight(0);\n    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n  }\n  \n  return lightColor;\n  /*\n  for (int i = 0; i < MAX_LIGHTS; i++) {\n    if (i >= lighting.pointLightCount) {\n      break;\n    }\n    PointLight pointLight = lighting.pointLight[i];\n    vec3 light_position_worldspace = pointLight.position;\n    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n  }\n\n  for (int i = 0; i < MAX_LIGHTS; i++) {\n    if (i >= lighting.directionalLightCount) {\n      break;\n    }\n    DirectionalLight directionalLight = lighting.directionalLight[i];\n    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n  }\n  */\n}\n\nfn lighting_getSpecularLightColor(cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32>{\n  var lightColor = vec3<f32>(0, 0, 0);\n  let surfaceColor = vec3<f32>(0, 0, 0);\n\n  if (lighting.enabled == 0) {\n    let view_direction = normalize(cameraPosition - position_worldspace);\n\n    switch (lighting.lightType) {\n      case 0, default: {\n        let pointLight: PointLight = lighting_getPointLight(0);\n        let light_position_worldspace: vec3<f32> = pointLight.position;\n        let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);\n        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n      }\n      case 1: {\n        let directionalLight: DirectionalLight = lighting_getDirectionalLight(0);\n        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n      }\n    }\n  }\n  return lightColor;\n}\n",vs:r.X,fs:r.l,defines:{LIGHTING_FRAGMENT:1},uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(e){const t={...e};return t.specularColor&&(t.specularColor=t.specularColor.map((e=>e/255))),{...i.defaultUniforms,...t}}}},23589:(e,t,o)=>{o.d(t,{R:()=>xe});var n=o(3361),r=o(327),i=o(87597),a=o(31886),s=o(4912),l=o(38925),c=o(8045),u=o(53618),d=o(78307),f=o(49332),h=o(94976),_=o(50473),g=o(71530);const p=542327876,m=31,S=0,C=1,b=2,T=3,R=4,E=7,M=20,A=21,x=131072,P=4,y={DXT1:_.b.COMPRESSED_RGB_S3TC_DXT1_EXT,DXT3:_.b.COMPRESSED_RGBA_S3TC_DXT3_EXT,DXT5:_.b.COMPRESSED_RGBA_S3TC_DXT5_EXT,"ATC ":_.b.COMPRESSED_RGB_ATC_WEBGL,ATCA:_.b.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL,ATCI:_.b.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL},w={DXT1:L,DXT3:v,DXT5:v,"ATC ":L,ATCA:v,ATCI:v};function D(e){const t=new Int32Array(e,0,m),o=t[A];(0,h.v)(Boolean(t[M]&P),"DDS: Unsupported format, must contain a FourCC code");const n=(r=o,String.fromCharCode(255&r,r>>8&255,r>>16&255,r>>24&255));var r;const i=y[n],a=w[n];(0,h.v)(i&&a,`DDS: Unknown pixel format ${o}`);let s=1;t[b]&x&&(s=Math.max(1,t[E]));const l=t[R],c=t[T],u=t[C]+4,d=new Uint8Array(e,u);return(0,g.C)(d,{mipMapLevels:s,width:l,height:c,sizeFunction:a,internalFormat:i})}function L(e,t){return(e+3>>2)*(t+3>>2)*8}function v(e,t){return(e+3>>2)*(t+3>>2)*16}const G=55727696,O=1347834371,B=13,I=52,H=0,F=2,U=4,X=6,N=7,k=11,$=12,K={0:[_.b.COMPRESSED_RGB_PVRTC_2BPPV1_IMG],1:[_.b.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG],2:[_.b.COMPRESSED_RGB_PVRTC_4BPPV1_IMG],3:[_.b.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG],6:[_.b.COMPRESSED_RGB_ETC1_WEBGL],7:[_.b.COMPRESSED_RGB_S3TC_DXT1_EXT],9:[_.b.COMPRESSED_RGBA_S3TC_DXT3_EXT],11:[_.b.COMPRESSED_RGBA_S3TC_DXT5_EXT],22:[_.b.COMPRESSED_RGB8_ETC2],23:[_.b.COMPRESSED_RGBA8_ETC2_EAC],24:[_.b.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2],25:[_.b.COMPRESSED_R11_EAC],26:[_.b.COMPRESSED_RG11_EAC],27:[_.b.COMPRESSED_RGBA_ASTC_4X4_KHR,_.b.COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR],28:[_.b.COMPRESSED_RGBA_ASTC_5X4_KHR,_.b.COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR],29:[_.b.COMPRESSED_RGBA_ASTC_5X5_KHR,_.b.COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR],30:[_.b.COMPRESSED_RGBA_ASTC_6X5_KHR,_.b.COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR],31:[_.b.COMPRESSED_RGBA_ASTC_6X6_KHR,_.b.COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR],32:[_.b.COMPRESSED_RGBA_ASTC_8X5_KHR,_.b.COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR],33:[_.b.COMPRESSED_RGBA_ASTC_8X6_KHR,_.b.COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR],34:[_.b.COMPRESSED_RGBA_ASTC_8X8_KHR,_.b.COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR],35:[_.b.COMPRESSED_RGBA_ASTC_10X5_KHR,_.b.COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR],36:[_.b.COMPRESSED_RGBA_ASTC_10X6_KHR,_.b.COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR],37:[_.b.COMPRESSED_RGBA_ASTC_10X8_KHR,_.b.COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR],38:[_.b.COMPRESSED_RGBA_ASTC_10X10_KHR,_.b.COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR],39:[_.b.COMPRESSED_RGBA_ASTC_12X10_KHR,_.b.COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR],40:[_.b.COMPRESSED_RGBA_ASTC_12X12_KHR,_.b.COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR]},z={0:V,1:V,2:W,3:W,6:j,7:j,9:q,11:q,22:j,23:q,24:j,25:j,26:q,27:q,28:function(e,t){return Math.floor((e+4)/5)*Math.floor((t+3)/4)*16},29:function(e,t){return Math.floor((e+4)/5)*Math.floor((t+4)/5)*16},30:function(e,t){return Math.floor((e+5)/6)*Math.floor((t+4)/5)*16},31:function(e,t){return Math.floor((e+5)/6)*Math.floor((t+5)/6)*16},32:function(e,t){return Math.floor((e+7)/8)*Math.floor((t+4)/5)*16},33:function(e,t){return Math.floor((e+7)/8)*Math.floor((t+5)/6)*16},34:function(e,t){return Math.floor((e+7)/8)*Math.floor((t+7)/8)*16},35:function(e,t){return Math.floor((e+9)/10)*Math.floor((t+4)/5)*16},36:function(e,t){return Math.floor((e+9)/10)*Math.floor((t+5)/6)*16},37:function(e,t){return Math.floor((e+9)/10)*Math.floor((t+7)/8)*16},38:function(e,t){return Math.floor((e+9)/10)*Math.floor((t+9)/10)*16},39:function(e,t){return Math.floor((e+11)/12)*Math.floor((t+9)/10)*16},40:function(e,t){return Math.floor((e+11)/12)*Math.floor((t+11)/12)*16}};function V(e,t){return(e=Math.max(e,16))*(t=Math.max(t,8))/4}function W(e,t){return(e=Math.max(e,8))*(t=Math.max(t,8))/2}function j(e,t){return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8}function q(e,t){return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16}function J(e){if((0,f.e)(e))return(0,f.V)(e);if(function(e){return new Uint32Array(e,0,m)[S]===p}(e))return D(e);if(function(e){const t=new Uint32Array(e,0,B)[H];return t===G||t===O}(e))return function(e){const t=new Uint32Array(e,0,B),o=t[F],n=t[U],r=K[o]||[],i=r.length>1&&n?r[1]:r[0],a=z[o],s=t[k],l=t[N],c=t[X],u=I+t[$],d=new Uint8Array(e,u);return(0,g.C)(d,{mipMapLevels:s,width:l,height:c,sizeFunction:a,internalFormat:i})}(e);throw new Error("Texture container format not recognized")}var Q=o(6143);const Y={...{dataType:null,batchType:null,name:"Texture Containers",id:"compressed-texture",module:"textures",version:d.x,worker:!0,extensions:["ktx","ktx2","dds","pvr"],mimeTypes:["image/ktx2","image/ktx","image/vnd-ms.dds","image/x-dds","application/octet-stream"],binary:!0,options:{"compressed-texture":{libraryPath:"libs/",useBasis:!1}}},parse:async(e,t)=>{if(t?.["compressed-texture"]?.useBasis){t.basis={format:{alpha:"BC3",noAlpha:"BC1"},...t.basis,containerFormat:"ktx2",module:"encoder"};return(await(0,Q.A)(e,t))[0]}return J(e)}};var Z,ee=o(77067);function te(e){let t;try{const o=new URL(e);t=`${o.origin}${o.pathname}`,t.startsWith("null")&&(t=null)}catch(o){t=null}return t||e}function oe(e,t=null){return t?`${e}?token=${t}`:e}!function(e){e.vertexCount="vertexCount",e.featureCount="featureCount"}(Z||(Z={}));var ne=o(10033);function re(e){switch(e){case"UInt8":return Uint8Array;case"UInt16":return Uint16Array;case"UInt32":return Uint32Array;case"Float32":return Float32Array;case"UInt64":return Float64Array;default:throw new Error(`parse i3s tile content: unknown type of data: ${e}`)}}const ie={UInt8:ne.GL.UNSIGNED_BYTE,UInt16:ne.GL.UNSIGNED_SHORT,Float32:ne.GL.FLOAT,UInt32:ne.GL.UNSIGNED_INT,UInt64:ne.GL.DOUBLE};function ae(e){switch(e){case"UInt8":return 1;case"UInt16":case"Int16":return 2;case"UInt32":case"Int32":case"Float32":return 4;case"UInt64":case"Int64":case"Float64":return 8;default:throw new Error(`parse i3s tile content: unknown size of data: ${e}`)}}var se;!function(e){e[e.DEFAULT=-1]="DEFAULT",e[e.LNGLAT=1]="LNGLAT",e[e.METER_OFFSETS=2]="METER_OFFSETS",e[e.LNGLAT_OFFSETS=3]="LNGLAT_OFFSETS",e[e.CARTESIAN=0]="CARTESIAN"}(se||(se={}));const le=new i.P([0,0,0]);const ce="i3s-attribute-type";async function ue(e,t,o,d,f){const h={attributes:{},indices:null,featureIds:[],vertexCount:0,modelMatrix:new a.k,coordinateSystem:0,byteLength:0,texture:null};if(t.textureUrl){const e=oe(t.textureUrl,d?.i3s?.token),o=function(e){switch(e){case"ktx-etc2":case"dds":return Y;case"ktx2":return ee.E;default:return c.$}}(t.textureFormat),i=f?.fetch||fetch,a=await i(e),s=await a.arrayBuffer();if(d?.i3s.decodeTextures){if(o===c.$){const e={...t.textureLoaderOptions,image:{type:"data"}};try{const t=await(0,l.N9)(s,[],e,f);h.texture=t}catch(_){const t=await(0,n.q)(s,o,e,f);h.texture=t}}else if(o===Y||o===ee.E){let e=await(0,r.H)(s,o,t.textureLoaderOptions);o===ee.E&&(e=e[0]),h.texture={compressed:!0,mipmaps:!1,width:e[0].width,height:e[0].height,data:e}}}else h.texture=s}return h.material=function(e,t){let o;e?o={...e,pbrMetallicRoughness:e.pbrMetallicRoughness?{...e.pbrMetallicRoughness}:{baseColorFactor:[255,255,255,255]}}:(o={pbrMetallicRoughness:{}},t?o.pbrMetallicRoughness.baseColorTexture={texCoord:0}:o.pbrMetallicRoughness.baseColorFactor=[255,255,255,255]);o.alphaCutoff=o.alphaCutoff||.25,o.alphaMode&&(o.alphaMode=o.alphaMode.toUpperCase());o.emissiveFactor&&(o.emissiveFactor=_e(o.emissiveFactor));o.pbrMetallicRoughness&&o.pbrMetallicRoughness.baseColorFactor&&(o.pbrMetallicRoughness.baseColorFactor=_e(o.pbrMetallicRoughness.baseColorFactor));t&&function(e,t){const o={source:{image:t}};e.pbrMetallicRoughness&&e.pbrMetallicRoughness.baseColorTexture?e.pbrMetallicRoughness.baseColorTexture={...e.pbrMetallicRoughness.baseColorTexture,texture:o}:e.emissiveTexture?e.emissiveTexture={...e.emissiveTexture,texture:o}:e.pbrMetallicRoughness&&e.pbrMetallicRoughness.metallicRoughnessTexture?e.pbrMetallicRoughness.metallicRoughnessTexture={...e.pbrMetallicRoughness.metallicRoughnessTexture,texture:o}:e.normalTexture?e.normalTexture={...e.normalTexture,texture:o}:e.occlusionTexture&&(e.occlusionTexture={...e.occlusionTexture,texture:o})}(o,t);return o}(t.materialDefinition,h.texture),h.material&&(h.texture=null),await async function(e,t,o,r,l){const c=e.byteLength;let d,f,h,_=0,g=0;if(o.isDracoGeometry){const t=await(0,n.q)(e,u.Vl,{draco:{attributeNameEntry:ce}});f=t.header.vertexCount,h=t.indices?.value;const{POSITION:o,NORMAL:r,COLOR_0:i,TEXCOORD_0:a,"feature-index":s,"uv-region":l}=t.attributes;d={position:o,normal:r,color:i,uv0:a,uvRegion:l,id:s},function(e,t){for(const o in t.loaderData.attributes){const n=t.loaderData.attributes[o];switch(n.name){case"POSITION":e.position.metadata=n.metadata;break;case"feature-index":e.id.metadata=n.metadata}}}(d,t);const c=function(e){return e?.metadata?.["i3s-feature-ids"]?.intArray}(s);c&&function(e,t){const o=e.id.value,n=new Float32Array(o.length);for(let r=0;r<o.length;r++)n[r]=t[o[r]];e.id.value=n}(d,c)}else{const{vertexAttributes:t,ordering:o,featureAttributes:n,featureAttributeOrder:i}=r.store.defaultGeometrySchema,a=function(e,t){let o=0,n=0,r=0;for(const{property:i,type:a}of t.store.defaultGeometrySchema.header){const t=re(a);switch(i){case Z.vertexCount.toString():n=new t(e,0,4)[0],o+=ae(a);break;case Z.featureCount.toString():r=new t(e,4,4)[0],o+=ae(a)}}return{vertexCount:n,featureCount:r,byteOffset:o}}(e,r);_=a.byteOffset,f=a.vertexCount,g=a.featureCount;const{attributes:s,byteOffset:l}=fe(e,_,t,f,o),{attributes:c}=fe(e,l,n,g,i);!function(e){const{id:t,faceRange:o}=e;if(!t||!o)return;const n=t.value,r=o.value,i=r[r.length-1]+1,a=new Uint32Array(3*i);let s=0,l=0;for(let c=1;c<r.length;c+=2){const e=Number(n[s]),t=l+3*(r[c]-r[c-1]+1);a.fill(e,l,t),s++,l=t}e.id.value=a}(c),d=function(e,t){return{...e,...t}}(s,c)}if(l?.i3s?.coordinateSystem&&l.i3s.coordinateSystem!==se.METER_OFFSETS)t.modelMatrix=function(e){const t=e.metadata,o=t?.["i3s-scale_x"]?.double||1,n=t?.["i3s-scale_y"]?.double||1,r=new a.k;return r[0]=o,r[5]=n,r}(d.position),t.coordinateSystem=se.LNGLAT_OFFSETS;else{const e=function(e,t){const o=t.mbs,n=e.value,r=e.metadata,l=new a.k,c=new i.P(o[0],o[1],o[2]),u=new i.P;return s.C.WGS84.cartographicToCartesian(c,u),s.C.WGS84.eastNorthUpToFixedFrame(u,l),e.value=function(e,t={},o){const n=new Float64Array(e.length),r=t["i3s-scale_x"]&&t["i3s-scale_x"].double||1,i=t["i3s-scale_y"]&&t["i3s-scale_y"].double||1;for(let a=0;a<n.length;a+=3)n[a]=e[a]*r+o.x,n[a+1]=e[a+1]*i+o.y,n[a+2]=e[a+2]+o.z;for(let a=0;a<n.length;a+=3)s.C.WGS84.cartographicToCartesian(n.subarray(a,a+3),le),n[a]=le.x,n[a+1]=le.y,n[a+2]=le.z;return n}(n,r,c),l}(d.position,o);t.modelMatrix=e.invert(),t.coordinateSystem=se.METER_OFFSETS}t.attributes={positions:d.position,normals:d.normal,colors:de(d.color),texCoords:d.uv0,uvRegions:de(d.uvRegion||d.region)},t.indices=h||null,d.id&&d.id.value&&(t.featureIds=d.id.value);for(const n in t.attributes)t.attributes[n]||delete t.attributes[n];return t.vertexCount=f,t.byteLength=c,t}(e,h,t,o,d)}function de(e){return e?(e.normalized=!0,e):e}function fe(e,t,o,n,r){const i={};for(const a of r)if(o[a]){const{valueType:r,valuesPerElement:s}=o[a];if(t+n*s*ae(r)<=e.byteLength){const o=e.slice(t);let l;if("UInt64"===r)l=he(o,n*s,ae(r));else{l=new(re(r))(o,0,n*s)}if(i[a]={value:l,type:ie[r],size:s},"color"===a)i.color.normalized=!0;t+=n*s*ae(r)}else if("uv0"!==a)break}return{attributes:i,byteOffset:t}}function he(e,t,o){const n=[],r=new DataView(e);let i=0;for(let a=0;a<t;a++){const e=r.getUint32(i,!0)+2**32*r.getUint32(i+4,!0);n.push(e),i+=o}return new Uint32Array(n)}function _e(e){const t=[...e];for(let o=0;o<e.length;o++)t[o]=e[o]/255;return t}const ge={dataType:null,batchType:null,name:"I3S Content (Indexed Scene Layers)",id:"i3s-content",module:"i3s",worker:!0,version:"4.3.2",mimeTypes:["application/octet-stream"],parse:async function(e,t,o){const{tile:n,_tileOptions:r,tileset:i,_tilesetOptions:a}=t?.i3s||{},s=r||n,l=a||i;if(!s||!l)return null;return await ue(e,s,l,t,o)},extensions:["bin"],options:{"i3s-content":{}}};var pe=o(67733),me=o(4999),Se=o(64257);const Ce={dataType:null,batchType:null,name:"I3S Node Page",id:"i3s-node-page",module:"i3s",version:"4.3.2",mimeTypes:["application/json"],parse:async function(e,t){return JSON.parse((new TextDecoder).decode(e))},extensions:["json"],options:{i3s:{}}};class be{tileset;nodePages=[];pendingNodePages=[];nodesPerPage;options;lodSelectionMetricType;textureDefinitionsSelectedFormats=[];nodesInNodePages;url;textureLoaderOptions={};constructor(e,t="",o){this.tileset={...e},this.url=t,this.nodesPerPage=e.nodePages?.nodesPerPage||64,this.lodSelectionMetricType=e.nodePages?.lodSelectionMetricType,this.options=o,this.nodesInNodePages=0,this.initSelectedFormatsForTextureDefinitions(e)}async getNodeById(e){const t=Math.floor(e/this.nodesPerPage);if(!this.nodePages[t]&&!this.pendingNodePages[t]){const e=oe(`${this.url}/nodepages/${t}`,this.options.i3s?.token);this.pendingNodePages[t]={status:"Pending",promise:(0,r.H)(e,Ce,this.options)},this.nodePages[t]=await this.pendingNodePages[t].promise,this.nodesInNodePages+=this.nodePages[t].nodes.length,this.pendingNodePages[t].status="Done"}"Pending"===this.pendingNodePages[t].status&&(this.nodePages[t]=await this.pendingNodePages[t].promise);const o=e%this.nodesPerPage;return this.nodePages[t].nodes[o]}async formTileFromNodePages(e){const t=await this.getNodeById(e),o=[],n=[];for(const f of t.children||[])n.push(this.getNodeById(f));const r=await Promise.all(n);for(const f of r)o.push({id:f.index.toString(),obb:f.obb});let i,a,s,l="jpg",c=[],u=!1;if(t&&t.mesh){const{url:e,isDracoGeometry:o}=t.mesh.geometry&&this.getContentUrl(t.mesh.geometry)||{isDracoGeometry:!1};i=e,u=o;const{textureData:n,materialDefinition:r}=this.getInformationFromMaterial(t.mesh.material);s=r,l=n.format||l,n.name&&(a=`${this.url}/nodes/${t.mesh.material.resource}/textures/${n.name}`),this.tileset.attributeStorageInfo&&(c=function(e,t,o){const n=[],{attributeStorageInfo:r=[]}=e;for(let i=0;i<r.length;i++){const e=r[i].key;n.push(`${t}/nodes/${o}/attributes/${e}/0`)}return n}(this.tileset,this.url,t.mesh.attribute.resource))}const d=this.getLodSelection(t);return Te({id:e.toString(),lodSelection:d,obb:t.obb,contentUrl:i,textureUrl:a,attributeUrls:c,materialDefinition:s,textureFormat:l,textureLoaderOptions:this.textureLoaderOptions,children:o,isDracoGeometry:u})}getContentUrl(e){let t=null;const o=this.tileset.geometryDefinitions[e.definition];let n=-1;if(this.options.i3s&&this.options.i3s.useDracoGeometry&&(n=o.geometryBuffers.findIndex((e=>e.compressedAttributes&&"draco"===e.compressedAttributes.encoding))),-1===n&&(n=o.geometryBuffers.findIndex((e=>!e.compressedAttributes))),-1!==n){const r=Boolean(o.geometryBuffers[n].compressedAttributes);t={url:`${this.url}/nodes/${e.resource}/geometries/${n}`,isDracoGeometry:r}}return t}getLodSelection(e){const t=[];return"maxScreenThresholdSQ"===this.lodSelectionMetricType&&t.push({metricType:"maxScreenThreshold",maxError:Math.sqrt(e.lodThreshold/(.25*Math.PI))}),t.push({metricType:this.lodSelectionMetricType,maxError:e.lodThreshold}),t}getInformationFromMaterial(e){const t={textureData:{name:null}};if(e){const o=this.tileset.materialDefinitions?.[e.definition];if(o){t.materialDefinition=o;const e=o?.pbrMetallicRoughness?.baseColorTexture?.textureSetDefinitionId;"number"==typeof e&&(t.textureData=this.textureDefinitionsSelectedFormats[e]||t.textureData)}}return t}initSelectedFormatsForTextureDefinitions(e){this.textureDefinitionsSelectedFormats=[];const t=this.getSupportedTextureFormats(),o=e.textureSetDefinitions||[];for(const n of o){const e=n&&n.formats||[];let o=null;for(const n of t){const t=e.find((e=>e.format===n));if(t){o=t;break}}o&&"ktx2"===o.format&&(this.textureLoaderOptions.basis={format:(0,Q.a)(),containerFormat:"ktx2",module:"encoder"}),this.textureDefinitionsSelectedFormats.push(o)}}getSupportedTextureFormats(){const e=[];if(!this.options.i3s||this.options.i3s.useCompressedTextures){const t=(0,Se.E)();t.has("etc2")&&e.push("ktx-etc2"),t.has("dxt")&&e.push("dds"),e.push("ktx2")}return e.push("jpg"),e.push("png"),e}}function Te(e){const t={};let o=[0,0,0,1];if(e.mbs)o=e.mbs,t.sphere=[...s.C.WGS84.cartographicToCartesian(e.mbs.slice(0,3)),e.mbs[3]];else if(e.obb){t.box=[...s.C.WGS84.cartographicToCartesian(e.obb.center),...e.obb.halfSize,...e.obb.quaternion];const n=(new pe.CB).fromCenterHalfSizeQuaternion(t.box.slice(0,3),e.obb.halfSize,e.obb.quaternion).getBoundingSphere();t.sphere=[...n.center,n.radius],o=[...e.obb.center,n.radius]}const n=e.lodSelection?.[0].metricType,r=e.lodSelection?.[0].maxError,i=me.WH.MESH,a=me.lH.REPLACE;return{...e,mbs:o,boundingVolume:t,lodMetricType:n,lodMetricValue:r,type:i,refine:a}}const Re=/layers\/[0-9]+$/,Ee=/\.slpk$/,Me=/nodes\/([0-9-]+|root)$/,Ae="PointCloud",xe={dataType:null,batchType:null,name:"I3S (Indexed Scene Layers)",id:"i3s",module:"i3s",version:"4.3.2",mimeTypes:["application/octet-stream"],parse:async function(e,t={},o){const i=o.url;t.i3s=t.i3s||{};if("504b0304"===function(e){if(e instanceof ArrayBuffer)return[...new Uint8Array(e,0,4)].map((e=>e.toString(16).padStart(2,"0"))).join("");return null}(e))throw new Error("Files with .slpk extention currently are not supported by I3SLoader");const a=te(i);let s,l;s="auto"===t.i3s.isTileset?Re.test(a)||Ee.test(a):t.i3s.isTileset;l="auto"===t.isTileHeader?Me.test(a):t.i3s.isTileHeader;e=s?await async function(e,t,o){const n=JSON.parse((new TextDecoder).decode(e));if(n?.layerType===Ae)throw new Error("Point Cloud layers currently are not supported by I3SLoader");const i=await async function(e,t,o){const n=te(o.url||"");let i,a;if(e.nodePages)i=new be(e,n,t),a=await i.formTileFromNodePages(0);else{const e=oe(`${n}/nodes/root`,t.i3s.token);a=await(0,r.H)(e,xe,{...t,i3s:{...t.i3s,loadContent:!1,isTileHeader:!0,isTileset:!1}})}return{...e,loader:xe,url:n,basePath:n,type:me.yy.I3S,nodePagesTile:i,root:a,lodMetricType:a.lodMetricType,lodMetricValue:a.lodMetricValue}}(n,t,o);return i}(e,t,o):l?await async function(e,t){return e=JSON.parse((new TextDecoder).decode(e)),function(e,t){const o=t.url||"";let n,r,i;e.geometryData&&(n=`${o}/${e.geometryData[0].href}`),e.textureData&&(r=`${o}/${e.textureData[0].href}`),e.attributeData&&(i=function(e,t){const{attributeData:o=[]}=t,n=[];for(let r=0;r<o.length;r++){const t=o[r].href.replace("./","");n.push(`${e}/${t}`)}return n}(o,e));const a=e.children||[];return Te({...e,children:a,url:o,contentUrl:n,textureUrl:r,textureFormat:"jpg",attributeUrls:i,isDracoGeometry:!1})}(e,t)}(e,o):await async function(e,t){return await(0,n.q)(e,ge,t)}(e,t);return e},extensions:["bin"],options:{i3s:{token:null,isTileset:"auto",isTileHeader:"auto",tile:null,tileset:null,_tileOptions:null,_tilesetOptions:null,useDracoGeometry:!0,useCompressedTextures:!0,decodeTextures:!0,coordinateSystem:se.METER_OFFSETS}}}},28453:(e,t,o)=>{o.d(t,{R:()=>a,x:()=>s});var n=o(96540);const r={},i=n.createContext(r);function a(e){const t=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),n.createElement(i.Provider,{value:t},e.children)}}}]);